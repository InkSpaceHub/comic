<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INK SPACE - Official Comic Page</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS ASAS SAMA */
        :root { --bg-body: #050505; --bg-card: #141414; --accent: #ff6600; --text-main: #ffffff; --text-muted: #888888; --border: 1px solid #333; }
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; font-family: 'Roboto Condensed', sans-serif; background-color: var(--bg-body); color: var(--text-main); background-image: radial-gradient(rgba(255,255,255,0.1) 1.5px, transparent 1.5px); background-size: 24px 24px; min-height: 100vh; }
        
        /* HEADER & HERO KEKAL SAMA */
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: rgba(10, 10, 10, 0.95); border-bottom: 2px solid var(--accent); position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .logo { font-family: 'Teko', sans-serif; font-size: 2rem; color: #fff; text-transform: uppercase; letter-spacing: 1px; text-decoration: none; }
        .logo span { color: var(--accent); }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { color: #ccc; text-decoration: none; font-weight: 700; transition: 0.3s; }
        .nav-links a:hover { color: var(--text-main); }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* GRID UTAMA */
        .section-header { border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
        .section-title { font-family: 'Teko'; font-size: 2rem; color: var(--accent); margin: 0; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 25px; }
        
        /* --- CARD STYLE (DIBETULKAN UNTUK FULL COVER) --- */
        .card { background: var(--bg-card); border: 1px solid #333; border-radius: 8px; overflow: hidden; transition: 0.3s; position: relative; cursor: pointer; }
        .card:hover { border-color: var(--accent); transform: translateY(-5px); box-shadow: 0px 5px 15px rgba(255, 102, 0, 0.2); }
        
        .card-img-wrap { 
            height: 350px; /* Tinggi ditingkatkan supaya cover muat cantik */
            overflow: hidden; 
            position: relative; 
            background: #222; /* Background gelap jika ratio gambar tak ngam */
        }
        .card-img-wrap img { 
            width: 100%; 
            height: 100%; 
            object-fit: contain; /* PENTING: Tunjuk SEMUA gambar, jangan crop */
            object-position: center; 
            transition: 0.3s; 
        }
        .card:hover .card-img-wrap img { transform: scale(1.05); }
        
        .card-info { padding: 15px; }
        .card-title { font-family: 'Teko'; font-size: 1.6rem; margin: 0; color: #fff; line-height: 1.1; }
        .card-author { color: #888; font-size: 0.9rem; margin: 0 0 10px 0; font-style: italic; }
        
        .card-meta { font-size: 0.9rem; color: var(--text-muted); display: flex; justify-content: space-between; border-top: 1px solid #333; padding-top: 10px; }
        .ep-badge { background: var(--accent); color: #000; padding: 2px 8px; font-weight: bold; border-radius: 4px; font-size: 0.8rem; }

        /* --- MODAL (POPUP EPISOD) --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .modal-overlay.active { display: flex; }
        .modal-box { background: #1a1a1a; width: 90%; max-width: 500px; border: 2px solid var(--accent); border-radius: 10px; overflow: hidden; box-shadow: 0 0 30px rgba(255, 102, 0, 0.3); animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-header { padding: 20px; background: #111; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-family: 'Teko'; font-size: 2rem; margin: 0; color: #fff; }
        .close-btn { background: none; border: none; color: #888; font-size: 1.5rem; cursor: pointer; }
        .close-btn:hover { color: #fff; }
        
        .modal-body { padding: 0; max-height: 60vh; overflow-y: auto; }
        .episode-item { padding: 15px 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s; text-decoration: none; color: #fff; }
        .episode-item:hover { background: #333; color: var(--accent); padding-left: 25px; }
        .episode-item:last-child { border-bottom: none; }
        .ep-name { font-weight: bold; font-size: 1.1rem; }
        .ep-date { font-size: 0.8rem; color: #666; }

        /* MOBILE FIX */
        @media (max-width: 768px) {
            .navbar { flex-direction: column; gap: 10px; }
            .nav-links { display: none; }
            .grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .card-img-wrap { height: 250px; } /* Mobile pun tinggi sikit */
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-left">
            <a href="#" class="logo">INK<span>SPACE</span></a>
        </div>
        <div class="nav-right" style="color:#888;">Official Series List</div>
    </nav>

    <div class="container">
        <div class="section-header">
            <h2 class="section-title">MY COMIC SERIES</h2>
        </div>

        <div class="grid" id="series-grid">
            <p style="color:#666;">Loading comics...</p>
        </div>
    </div>

    <div class="modal-overlay" id="epModal">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">TITLE</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalList">
                </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // CONFIG (SAMA MACAM ADMIN)
        const firebaseConfig = {
            apiKey: "AIzaSyDqDvRp1IGmhC5_EtQ8I5lBBfkPOaUBR-A",
            authDomain: "inkspace-c9dca.firebaseapp.com",
            databaseURL: "https://inkspace-c9dca-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "inkspace-c9dca",
            storageBucket: "inkspace-c9dca.firebasestorage.app",
            messagingSenderId: "92054275710",
            appId: "1:92054275710:web:b5e13736d46d7143307a2f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const grid = document.getElementById('series-grid');

        // BACA DATA 'SERIES'
        const seriesRef = ref(db, 'series');

        onValue(seriesRef, (snapshot) => {
            grid.innerHTML = '';
            const data = snapshot.val();

            if (!data) {
                grid.innerHTML = '<p>No comics found yet.</p>';
                return;
            }

            // Convert object to array & Sort
            const seriesList = Object.keys(data).map(key => {
                return { id: key, ...data[key] };
            });
            seriesList.sort((a, b) => b.last_updated - a.last_updated);

            seriesList.forEach(s => {
                const epCount = s.episodes ? Object.keys(s.episodes).length : 0;
                
                // AMBIL DATA AUTHOR
                const authorName = s.author ? s.author : "Unknown Author";

                // Buat Kad
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => openModal(s);

                // UPDATE HTML KAD (CSS updated: object-fit: contain)
                card.innerHTML = `
                    <div class="card-img-wrap">
                        <img src="${s.cover}" alt="${s.title}">
                    </div>
                    <div class="card-info">
                        <h3 class="card-title">${s.title}</h3>
                        <p class="card-author">By: ${authorName}</p>
                        
                        <div class="card-meta">
                            <span class="ep-badge">${epCount} EPISODES</span>
                            <span>UPDATED</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        });

        // --- MODAL LOGIC (DENGAN COVER DI ATAS) ---
        window.openModal = function(seriesData) {
            
            // 1. Set Tajuk Modal
            document.getElementById('modalTitle').innerText = seriesData.title;
            
            const listContainer = document.getElementById('modalList');
            listContainer.innerHTML = ''; // Kosongkan list dulu

            // 2. TAMBAH GAMBAR COVER (Modal pun guna full size contain)
            if(seriesData.cover) {
                const coverImg = document.createElement('img');
                coverImg.src = seriesData.cover;
                
                // Style supaya gambar nampak cantik dalam modal
                coverImg.style.width = "100%";
                coverImg.style.height = "auto"; // Auto height supaya full cover nampak
                coverImg.style.maxHeight = "300px";
                coverImg.style.objectFit = "contain"; // Full cover
                coverImg.style.backgroundColor = "#000";
                coverImg.style.borderRadius = "0 0 10px 10px";
                coverImg.style.marginBottom = "20px";
                coverImg.style.borderBottom = "2px solid #ff6600";
                
                listContainer.appendChild(coverImg);
            }

            // 3. Masukkan Senarai Episod (Logik asal kekal)
            if (seriesData.episodes) {
                const episodes = Object.keys(seriesData.episodes).map(k => seriesData.episodes[k]);
                episodes.sort((a, b) => a.name.localeCompare(b.name, undefined, {numeric: true, sensitivity: 'base'}));

                episodes.forEach(ep => {
                    const link = document.createElement('a');
                    link.className = 'episode-item';
                    const urlTitle = encodeURIComponent(seriesData.title);
                    const urlEp = encodeURIComponent(ep.name);
                    link.href = `read.html?title=${urlTitle}&ep=${urlEp}`;
                    
                    link.innerHTML = `
                        <span class="ep-name">${ep.name}</span>
                        <span class="ep-date"><i class="fas fa-chevron-right"></i></span>
                    `;
                    listContainer.appendChild(link);
                });
            } else {
                const msg = document.createElement('div');
                msg.innerHTML = "No episodes yet.";
                msg.style.padding = "20px";
                msg.style.textAlign = "center";
                msg.style.color = "#666";
                listContainer.appendChild(msg);
            }

            document.getElementById('epModal').classList.add('active');
        }

        window.closeModal = function() {
            document.getElementById('epModal').classList.remove('active');
        }

        document.getElementById('epModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('epModal')) closeModal();
        });

    </script>
</body>
</html>
